<apex:page controller="Autorizar_NV_Controller" sidebar="false" >

    <script>
        function switchMenu(obj,obj1,obj2) 
        {
            var el = document.getElementById(obj);                                       
            if ( el.style.display != 'none' ) {
            el.style.display = 'none';
            }
            else {
            el.style.display = '';
            }
            var e2 = document.getElementById(obj1);                                       
            if ( e2.style.display != 'none' ) {
            e2.style.display = 'none';
            }
            else {
            e2.style.display = '';
            }
             var e3 = document.getElementById(obj2);                                       
            if ( e2.style.display != 'none' ) {
            e3.style.display = 'none';
            }
            else {
            e3.style.display = '';
            }

        }
    </script>

    <apex:sectionHeader title="Datos para Nota de Venda" subtitle=""/>
    <apex:pageMessages />    
    <apex:form >
        <apex:pageBlock >                        
            <apex:pageBlockSection showHeader="false" columns="3" id="principal">                
                <apex:inputField value="{!opp.AccountId}" id="cuenta"/>
                <apex:inputField value="{!opp.Safra__c}" id="safra"/>
                <apex:inputField value="{!cuenta.Estado__c}" id="estado"/>
                <apex:inputField value="{!cuenta.Responsavel__c}" id="responsavel"/>
                <apex:inputField value="{!contrato.Tipo_de_Cota_o__c}" id="tipocot"/>
                <apex:inputField value="{!contrato.Cotacao_de_soja__c}" id="contrato"/>              
                <apex:outputText value=" " />
                <apex:commandButton action="{!Buscar}" style="float:center;margin-left:500px;width:80px" value="Pesquisar" rerender="seccion_resultado,seccion_facturar" status="status" oncomplete="MostrarMsj('{!Mensaje}')"></apex:commandButton>
                <apex:actionStatus startText="Consultando..." id="status"/>
            </apex:pageBlockSection>                                                            
        </apex:pageBlock>
        
        <apex:pageBlock id="seccion_facturar">
           <apex:pageBlockSection columns="4" title="Datos Para Facturar">
               <apex:pageBlockSectionItem labelStyle="width:150px">
                    <apex:outputLabel value="Data"/>
                    <apex:inputField value="{!Fact_Param.Fecha_fijacion_T_de_cambio__c}"/>
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem labelStyle="width:150px">
                    <apex:outputLabel value="Cotação"/>
                    <apex:inputField value="{!Fact_Param.Tipo_de_cambio__c}"/>
                </apex:pageBlockSectionItem>    
                <apex:pageBlockSectionItem labelStyle="width:150px">
                    <apex:outputLabel value="Condições de Pagamento"/>
                    <apex:inputField value="{!Fact_Param.Condicion_de_Pago__c}"/>
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem labelStyle="width:150px">
                    <apex:outputLabel value="Sucursal"/>
                    <apex:inputField value="{!Fact_Param.Sucursal__c}"/>
                </apex:pageBlockSectionItem>    
               <!--<apex:commandButton style="float:right;margin-right:30px;width:110px;background:black;color:white" value="Facturar Seleccion" action="{!CrearFacturas}" oncomplete="MostrarMsj('{!Mensaje}')" rerender="seccion_resultado,seccion_facturar,principal"></apex:commandButton>-->             
            </apex:pageBlockSection>                                           
        </apex:pageBlock>
                             
        <apex:pageBlock >                               
            <apex:pageBlockSection columns="1" title="Resultado" id="seccion_resultado">
            <apex:pageMessages />
            <apex:pageBlock >
               <apex:commandButton action="{!selectAll}" style="width:110px" value="Selecionar Todos" rerender="resultado"></apex:commandButton> 
               <apex:commandButton action="{!quitarSeleccion}" style="width:130px" value="Remover a Seleção" rerender="resultado"></apex:commandButton> 
               <!--<apex:commandButton onclick="openWin('{!verDetalles}')" disabled="{!VerDetallesDisabled}" style="float:right;margin-right:30px;width:110px" value="Ver Detalles"></apex:commandButton>-->                              
               <apex:commandButton style="float:right;margin-right:16px;width:130px;background:black;color:white" value="Autorizar NV" action="{!AutorizarNV}" oncomplete="MostrarMsj('{!Mensaje}')" rerender="seccion_resultado,seccion_facturar,principal"></apex:commandButton>
            <script>
               function openWin(url){                                  
                   window.open(url,'','fullscreen,scrollbars');
               }
               
               function MostrarMsj(msj){
                   if (msj != '') alert (msj);
               }
            </script>            
            </apex:pageBlock>                               
            <apex:pageblocktable value="{!listaOpp}"  var="oppl" id="resultado">
            <apex:column >
                   <apex:facet name="header">                                        
                         Items                                                                               
                    </apex:facet>
                    <apex:outputpanel id="plusimage">
                          <apex:image url="{!$Resource.Plus_Image}" onclick="switchMenu('{!$Component.inlinetablesec}','{!$Component.minusimage}','{!$Component.plusimage}')" title="Expand - Team Member's"/> 
                    </apex:outputpanel>
                    <apex:outputpanel id="minusimage" style="display:none;">
                          <apex:image url="{!$Resource.Minus_Image}" onclick="switchMenu('{!$Component.inlinetablesec}','{!$Component.plusimage}','{!$Component.minusimage}')" title="Collapse - Team Member's"/>
                    </apex:outputpanel>
                    <apex:outputpanel id="inlinetablesec" style="display:none;">
                                                <apex:variable value="{!0}" var="rowNum"/>
                                                <apex:repeat var="count" value="{!oppl.oport.Account.Name}">
                                                    <apex:variable var="rowNum" value="{!rowNum+1}"/>
                                                </apex:repeat>
                            <apex:outputText rendered="{!rowNum=0}">  No Team Members  </apex:outputText>
                        <apex:pageblocktable value="{!oppl.Oport.OpportunityLineItems}" var="tm" rendered="{!rowNum>0}">
                            <apex:column headerValue="Produto">
                                   <apex:outputfield value="{!tm.PriceBookEntry.Product2.Name}"/>
                             </apex:column>
                             <apex:column headerValue="Quantidade">
                                   <apex:outputfield value="{!tm.Quantity}"/>
                             </apex:column>                          
                             <apex:column headerValue="Preço de Venda">
                                   <apex:outputfield value="{!tm.UnitPrice}"/>
                             </apex:column>   
                             <apex:column headerValue="Preço Total">
                                   <apex:outputfield value="{!tm.TotalPrice}"/>
                             </apex:column>                                                 
                        </apex:pageblocktable>
                   </apex:outputpanel>     
            </apex:column>
            <apex:column headervalue="Sel.">
                    <apex:inputCheckbox value="{!oppl.Selected}"/>
            </apex:column>
            <apex:column headervalue="Nome da conta">
                    <apex:OutputLink value="../{!oppl.oport.Account.Id}"> <apex:outputField value="{!oppl.oport.Account.Name}"/></apex:outputLink>
            </apex:column>
            <apex:column headervalue="Nome da oportunidade">
                    <apex:OutputLink value="../{!oppl.oport.Id}"> <apex:outputField value="{!oppl.oport.Name}"/></apex:outputLink>
            </apex:column>
            <apex:column headervalue="Safra">
                    <apex:OutputField value="{!oppl.oport.Safra__c}"/>
            </apex:column>
            <apex:column headervalue="Data">
                    <apex:OutputField value="{!oppl.oport.CloseDate}"/> 
            </apex:column>
        </apex:pageblocktable>   
        </apex:pageBlockSection>                        
        </apex:pageBlock>
                
    </apex:form>

</apex:page>