<?xml version="1.0" encoding="UTF-8"?>
<WebLink xmlns="http://soap.sforce.com/2006/04/metadata">
    <fullName>Asignar</fullName>
    <availability>online</availability>
    <description>Pasa el reclamo para que lo gestione un supervisor comercial o Gerente de Desarrollo</description>
    <displayType>button</displayType>
    <linkType>javascript</linkType>
    <masterLabel>Atribuir</masterLabel>
    <openType>onClickJavaScript</openType>
    <protected>false</protected>
    <url>{!REQUIRESCRIPT(&quot;/soap/ajax/10.0/connection.js&quot;)} 
{!REQUIRESCRIPT(&quot;/soap/ajax/10.0/apex.js&quot;)} 

var now = new Date();
var usuario = &quot;{!$User.Id}&quot;;
var rt = sforce.connection.query(&quot;SELECT Id FROM RecordType WHERE Name = &apos;RECLAMO COMERCIAL&apos; limit 1&quot;);
    var status = &apos;Reclamo Comercial&apos;
records = rt.getArray(&quot;records&quot;);
rt_caso = records[0].Id.toString();

var caseObj = new sforce.SObject(&quot;Case&quot;); 
caseObj.Id = &apos;{!Case.Id}&apos;; 
caseObj.RecordTypeId = rt_caso; //Poner id del recordtype en cuestion 
caseObj.Status = status; 
caseObj.Fecha_de_Asignaci_n__c = getCurrentSalesForceTime();

var result = sforce.connection.update([caseObj]);
if(result[0].success==&apos;true&apos;){
var result = sforce.apex.execute(&quot;reclamosController&quot;,&quot;Asignar&quot;, {caseId : caseObj.Id, userId: usuario});
}
if (result[0].success==&apos;false&apos;) { 
alert(result[0].errors.message); 
} else { 
window.location.href=window.location.href; 
}

function getCurrentSalesForceTime(){
    var currentDateTime = sforce.connection.getServerTimestamp();
    currentDateTime = setStringToDateTime(currentDateTime.timestamp);
 
    return currentDateTime;
}

function setStringToDateTime(dateTimeObj){
    var dateTimeObj;
 
    if (dateTimeObj != null) {
        dateTimeObj = sforce.internal.stringToDateTime(dateTimeObj);
    }
 
    return dateTimeObj;
}</url>
</WebLink>
