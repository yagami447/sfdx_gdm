<aura:component controller="RequisicaoTreeController" implements="flexipage:availableForAllPageTypes,force:hasRecordId" access="global">
    <ltng:require styles="{!$Resource.SLDS2 + '/assets/styles/lightning-design-system-ltng.css'}"/>

    <aura:attribute name="isLoanding" type="Boolean" default="true"/>

        
    <!-- Attribute Declration For Pagination -->
    <aura:attribute name="PaginationList" type="List"/>
    <aura:attribute name="startPage" type="Integer" />
    <aura:attribute name="endPage" type="Integer"/>
    <aura:attribute name="totalRecords" type="Integer"/>
    <aura:attribute name="pageSize" type="Integer" default="25"/>
    <aura:attribute name="currentPage" type="integer" default="1"/>
    <aura:attribute name="totalPagesCount" type="integer"/>
    <aura:attribute name="totalLabel" type="String" />

    <!-- Attribute Declration For Pagination End-->
    
    
    
    <aura:handler name="init" value="{!this}" action="{!c.doInit}"/>

    <aura:attribute name="gridColumns" type="List" access="PRIVATE" />
    <aura:attribute name="gridData" type="RequisicaoDeCompraHelper[]" access="PRIVATE" />

    
    <aura:if isTrue="{!v.isLoanding}">
        <lightning:spinner alternativeText="Loading" size="medium" />
    </aura:if>
    
    <div class="slds-grid slds-gutters" style="margin:10px;">
        <div class="slds-col slds-size_4-of-5">
            
        </div>            
        <div class="slds-col slds-size_1-of-5" >
            <div class="slds-align_absolute-center" >   
                <lightning:button label="Salvar produtos" variant="brand" onclick="{!c.guardar}"></lightning:button>
            </div>            
        </div>            
    </div>
    <div >
       <table aria-multiselectable="true" class="slds-table slds-table_bordered slds-table_edit slds-table_fixed-layout slds-table_resizable-cols slds-tree slds-table_tree" role="treegrid">
            <thead>
                <tr class="slds-line-height_reset">
                    <aura:iteration  items="{!v.gridColumns}" var="column">
                    <th aria-label="{!column.label}" aria-sort="none" class="slds-has-button-menu slds-is-resizable slds-is-sortable" style="{!'width:' +column.initialWidth + 'px'}" scope="col">
                        <a class="slds-th__action slds-text-link_reset" href="javascript:void(0);"  role="button" tabindex="-1">
                            <div class=" slds-resizable slds-grid slds-grid_vertical-align-center slds-has-flexi-truncate">
                                <span  title="{!column.label}">{!column.label}</span>
                            </div>
                        </a>
                         <div class="slds-resizable">
                            <input aria-label="Account Name column width" class="slds-resizable__input slds-assistive-text" id="cell-resize-handle-6" max="1000" min="20" tabindex="-1" type="range" />
                            <span class="slds-resizable__handle">
                                <span class="slds-resizable__divider"></span>
                            </span>
                        </div>
                    </th>
                    </aura:iteration>
                </tr>
            </thead>
            <tbody>
                <aura:iteration  items="{!v.PaginationList}" var="item" indexVar="itemIndex">
                    <tr aria-expanded="true" aria-level="1" aria-posinset="1" aria-selected="false" aria-setsize="4" class="slds-hint-parent" tabindex="0">
                        <td  class="slds-tree__item" data-label="Producto" scope="row">
                            <aura:if isTrue="{!not(empty(item.childs))}">
                                <lightning:button value="{!itemIndex}" onclick="{!c.toggle}" variant="bare" >
                                    <lightning:icon iconName="{!item.expanded?'utility:chevrondown':'utility:chevronright'}" size="xx-small"/>
                                </lightning:button>
                                <aura:set attribute="else">
                                    <lightning:icon iconName="" size="xx-small"/>
                                </aura:set>
                            </aura:if>

                            <!--    <div class="slds-truncate" title="{!item.varietyName}">-->
                            <div class="slds-hint-parent"
                                 title="{!item.varietyName}">
                                 
                                <b>     {!item.varietyName}
                                </b>
                            </div>
                        </td>
                        <!--  COLUMNA EMBALAGEM   -->
                        <td> 
                            <div class="slds-truncate"  data-label="embalagem"
                                 role="gridcell">
                                 <b>    {!item.varietyEmbalagem} 
                                     
                                 </b>
                                 
                            </div>
                        </td>
                        <!--  COLUMNA TRATAMENTO   -->
                        <td> 
                            <div class="slds-truncate"  data-label="tratamento"
                                 role="gridcell">
                                <b>    {!item.varietyTratamento} 
                                 </b>
                            </div>
                        </td>                                                 
                        <td> 
                            <div class="slds-truncate" data-label="{!v.totalLabel}"
                                 role="gridcell" style="text-align: left; margin-right: 18px;">
                             {!item.quantity}
                            </div>
                        </td>
                        <td> 
                            <div class="slds-truncate"  data-label="Quantidade"
                                 role="gridcell">
                                <lightning:input class="slds-col" type="number"
                                                 variant="label-hidden"
                                                 value="{!item.managerQuantity}"/>
                            </div>
                        </td>  
                        <td> 
                            <div class="slds-truncate"  data-label="Nombre de Registro"
                                 role="gridcell">
                                <a href="{!'/'+item.reqId}" tabindex="-1">
                                    {!item.reqName} 
                                </a>
                            </div>
                        </td>
                        <!--  COLUMNA NOMBRE CUENTA   -->
                        <td> 
                            <div class="slds-truncate"  data-label="Cuenta"
                                 role="gridcell">
                                 
                                    {!item.cuenta} 
                                 
                            </div>
                        </td> 
                        
                        <!-- -->
                        <td data-label="Nivel" role="gridcell">
                            <div class="slds-truncate" title="{!item.owner}">
                                <a href="{!'/'+item.ownerId}" tabindex="-1">
                                    {!item.owner}
                                </a>
                            </div>
                        </td>
                       <!-- <td data-label="Tipo" role="gridcell">
                            <div class="slds-truncate" title="{!item.Tipo__c}">{!item.type}</div>
                        </td>
                        <td data-label="Região" role="gridcell">
                            <div class="slds-truncate"  data-label="Região" role="gridcell">
                                {!item.region}
                            </div>
                        </td>
                        <td> 
                            <div data-label="Marca" role="gridcell">
                                {!item.marca}
                            </div>
                        </td>    -->                                                                 
                    </tr>
                    
                    <aura:if isTrue="{!item.expanded}">
                        <aura:iteration items="{!item.childs}" var="child">

                            <tr aria-level="2" aria-posinset="1" aria-selected="false" aria-setsize="1" class="slds-hint-parent">
                                <td>
                                	<div class="slds-truncate"
                                         title="{!child.varietyName}">
                                        &nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;
                                        {!child.varietyName}
                                    </div> 
                                    
                                </td>
                                <!--  COLUMNA EMBALAGEM   -->
                                <td> 
                                    <div class="slds-truncate"  data-label="embalagem"
                                        role="gridcell">
                                        
                                            {!child.embalagem} 
                                        
                                    </div>
                                </td>
                                <!--  COLUMNA TRATAMENTO   -->
                                <td> 
                                    <div class="slds-truncate"  data-label="tratamento"
                                        role="gridcell">
                                        
                                            {!child.tratamento} 
                                        
                                    </div>
                                </td> 
                                <td>  
                                <div class="slds-truncate" data-label="{!v.totalLabel}"
                                     role="gridcell" style="text-align: left; margin-right: 18px;">
                                    {!child.quantity}</div>
                                </td>
                                <td> 
                                    <div class="slds-truncate"  data-label="Quantidade" role="gridcell"  style="text-align: right; margin-right: 18px;">{!child.managerQuantity}</div>
                                </td> 
                                <td> 
                                    <div class="slds-truncate"  data-label="Nombre de Registro" role="gridcell">
                                        <a href="{!'/'+child.reqId}" tabindex="-1">
                                            {!child.reqName} 
                                        </a>
                                    </div>
                                </td>  
                                
                                <!-- CUENTA DEL PRODUCTO CHILD -->
                                <td> 
                                    <div class="slds-truncate"  data-label="Nombre de Registro" role="gridcell">
                                         
                                            {!child.cuenta} 
                                         
                                    </div>
                                </td>  
                                
                                
                                
                                <!--<td>
                                    <div class="slds-truncate" data-label="Nivel" role="gridcell">
                                        <a href="{!'/'+child.ownerId}" tabindex="-1">
                                        	{!child.owner}
                                        </a>
                                    </div>
                                </td>
                                <td>
                                    <div class="slds-truncate" data-label="Tipo" role="gridcell">
                                        {!child.type}
                                    </div>
                                </td>
                                <td> 
                                    <div class="slds-truncate"  data-label="Região" role="gridcell">
                                        {!child.region}
                                        
                                    </div>
                                </td>
                                <td> 
                                    <div data-label="Marca" role="gridcell">
                                        {!child.marca}
                                        
                                    </div>
                                </td>     -->                                                                                         
                            </tr>
                        </aura:iteration>
                        
                    </aura:if>
                    
                    
                </aura:iteration>
                
                
                
           </tbody>
        </table>
        <br></br>
        <div class="slds-align_absolute-center">
            <lightning:buttonGroup >
                <lightning:button label="Volta" disabled="{!v.startPage == 0}"  
                                  onclick="{!c.previous}" variant="brand"
                                  iconName='utility:back'/>
                <span class="slds-badge slds-badge_lightest"
                      style="margin-right: 10px;margin-left: 10px;">
                    {!v.currentPage}/{!v.totalPagesCount}
                </span>
                <lightning:button label="Seguinte" disabled="{!v.endPage >= v.totalRecords - 1}" 
                                  onclick="{!c.next}" variant="brand"
                                  iconName='utility:forward' iconPosition='right'/>
            </lightning:buttonGroup>    
        </div>

    </div>
 
</aura:component>