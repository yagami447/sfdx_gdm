<?xml version="1.0" encoding="UTF-8"?>
<WebLink xmlns="http://soap.sforce.com/2006/04/metadata">
    <fullName>Oferta</fullName>
    <availability>online</availability>
    <description>Crea la Oferta en SAP</description>
    <displayType>button</displayType>
    <linkType>javascript</linkType>
    <masterLabel>Oferta</masterLabel>
    <openType>onClickJavaScript</openType>
    <protected>false</protected>
    <url>{!REQUIRESCRIPT(&quot;/soap/ajax/10.0/connection.js&quot;)}
{!REQUIRESCRIPT(&quot;/soap/ajax/10.0/apex.js&quot;)}

var id = &quot;{!Opportunity.Id}&quot;;
var nro = &quot;{!Opportunity.Name}&quot;;
var stage = &quot;{!Opportunity.StageName}&quot;;
var idOrigen = &quot;{!Opportunity.Origen__c}&quot;;
var fecha_tipo_cambio = &quot;{!Opportunity.Fecha_fijacion_T_de_cambio__c}&quot;;
var tipo_cambio = &quot;{!Opportunity.Tipo_de_cambio__c}&quot;;
var condicion_pago = &quot;{!Opportunity.Condicion_de_Pago__c}&quot;;
var tipo = &quot;{!Opportunity.Tipo__c}&quot;;
var rt_opp = &quot;{!Opportunity.RecordTypeId}&quot;;
var tieneOpli = &quot;{!Opportunity.HasOpportunityLineItem}&quot;;
var resp = &apos;&apos;;
resp = &quot;{!Opportunity.Responsable__c}&quot;;
var rt = sforce.connection.query(&quot;SELECT Id, Name FROM RecordType WHERE Id = &apos;&quot;+rt_opp+ &quot;&apos; limit 1&quot;);
records = rt.getArray(&quot;records&quot;);
rt_VB = records[0].Name.toString();
alert(rt_VB);


var pasa = true;

if (tipo.substring(0,4) != &apos;ZBNC&apos;){

if(tieneOpli == false){
alert(&apos;Opp sem Produtos.&apos;);
pasa = false;
}

if(pasa &amp;&amp; (rt_VB = &apos;VB - Autorizada&apos; &amp;&amp; stage == &apos;AN - Anulada&apos;)){
alert(&apos;Venda da Basica Anulada&apos;);
pasa = false;
}

if (pasa &amp;&amp; condicion_pago == &apos;&apos;){
alert(&apos;Falta Condicion de Pago&apos;);
pasa = false;
}
if (pasa &amp;&amp; (idOrigen == &apos;&apos;)){
alert(&apos;Falta Origem&apos;);
pasa = false;
}
}
if (pasa) {
var result = sforce.apex.execute(&quot;Opp_Sap_AltaOf&quot;,&quot;enviarSAP&quot;, {oppId : id, etapa : stage, target : 200});
alert(&apos;Proceso Terminado.&apos;);

if (result[0].success==&apos;false&apos;) {
alert(result[0].errors.message);
}

window.location.reload(true);
}</url>
</WebLink>
