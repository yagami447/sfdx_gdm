<?xml version="1.0" encoding="UTF-8"?>
<WebLink xmlns="http://soap.sforce.com/2006/04/metadata">
    <fullName>Finalizar_Visita_Campo</fullName>
    <availability>online</availability>
    <displayType>button</displayType>
    <linkType>javascript</linkType>
    <masterLabel>Finalizar Visita Campo</masterLabel>
    <openType>onClickJavaScript</openType>
    <protected>false</protected>
    <url>{!REQUIRESCRIPT(&quot;/soap/ajax/10.0/connection.js&quot;)} 
{!REQUIRESCRIPT(&quot;/soap/ajax/10.0/apex.js&quot;)} 

var rt = sforce.connection.query(&quot;SELECT Id FROM RecordType WHERE Name = &apos;RECLAMO COMERCIAL ACEPTADO&apos; limit 1&quot;); 
var status = &apos;Reclamo Comercial Aceptado&apos;; 
 
var FechaVisita = &apos;{!Case.Fecha_Visita_Campo__c}&apos;; 
records = rt.getArray(&quot;records&quot;); 
rt_caso = records[0].Id.toString(); 
if(FechaVisita != null &amp;&amp; FechaVisita !=&apos;&apos;){ 
var caseObj = new sforce.SObject(&quot;Case&quot;); 
caseObj.Id = &apos;{!Case.Id}&apos;; 
caseObj.RecordTypeId = rt_caso; //Poner id del recordtype en cuestion  
caseObj.Status = status; 
var result = sforce.connection.update([caseObj]); 
if (result[0].success==&apos;false&apos;) { 
alert(result[0].errors.message); 
} else { 
window.location.href=window.location.href; 
} 

}else{ 
alert(&apos;Debe completar la Fecha de Visita a Campo&apos;); 
}</url>
</WebLink>
