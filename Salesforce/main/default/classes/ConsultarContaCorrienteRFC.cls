//Generated by wsdl2apex

public class ConsultarContaCorrienteRFC {
    public ConsultarContaCorriente.ZetfiFbl5n result {get;set;}
    public String ErrorSap = '';
    @TestVisible private SAP_environment_variables__mdt environmentVariables;
    
    @TestVisible private String IAisel = '';
    @TestVisible private String IApar = '';
    @TestVisible private String IAugdtD = '';
    @TestVisible private String IAugdtH = '';
    @TestVisible private String IBlart = '';
    @TestVisible private String IBudatD = '';
    @TestVisible private String IBudatH = '';
    @TestVisible private String IBukrs = '';
    @TestVisible private String IClsel = '';
    @TestVisible private String IFechaD = '';
    @TestVisible private String IFechaH = '';
    @TestVisible private String IHoraD = '';
    @TestVisible private String IHoraH = '';
    
    @TestVisible private String IKunnrD = '';
    
    @TestVisible private String IKunnrH = '';
    @TestVisible private String INorm = '';
    @TestVisible private String IOpsel = '';
    @TestVisible private String IShbv = '';
    @TestVisible private String IStid2 = '';
    @TestVisible private String IStida = '';
    @TestVisible private String IUmskz = '';
    @TestVisible private ConsultarContaCorriente.ZtfiXblnr IXblnr;
    
    public ConsultarContaCorrienteRFC(){
        this.environmentVariables = [
            SELECT  Username__c,Password__c,Target__c
            FROM SAP_environment_variables__mdt
            LIMIT 1
        ];
        IApar = 'X';
        IBukrs = '01BR';
        IHoraD = '00:00:00';
        IHoraH = '00:00:00';
        INorm = 'X';
        IShbv = 'X';
        IStida = String.valueOf(System.today());
        IUmskz = 'X';
        IXblnr = new ConsultarContaCorriente.ZtfiXblnr();
        // IXblnr.item = new List<ConsultarContaCorriente.ZsfiXblnr>();
        
    }
    

    // Action method
    public void startRequest(Id idAccount){
        Account cuenta = [
            SELECT ID,Codigo_sap__c
            FROM Account
            WHERE Id = :idAccount
        ];
        
        IKunnrD =  cuenta.Codigo_sap__c;
        
        ConsultarContaCorriente.ZCA_CONSULTA_FBL5N soap = new ConsultarContaCorriente.ZCA_CONSULTA_FBL5N();
        
        soap.inputHttpHeaders_x = new Map<String, String>();
        String encodedusernameandpassword;
        
        String myData = environmentVariables.Username__c + ':' + environmentVariables.Password__c;
        Blob hash = Blob.valueOf(myData);
        encodedusernameandpassword = EncodingUtil.base64Encode(hash);
        soap.timeout_x = 60000;
        soap.inputHttpHeaders_x.put('Authorization', 'Basic '+ encodedusernameandpassword);
        try{
            result = soap.ZcaConsultaFbl5n(
                IAisel,
                IApar,
                IAugdtD,
                IAugdtH,
                IBlart,
                IBudatD,
                IBudatH,
                IBukrs,
                IClsel,
                IFechaD,
                IFechaH,
                IHoraD,
                IHoraH,
                IKunnrD,
                IKunnrH,
                INorm,
                IOpsel,
                IShbv,
                IStid2,
                IStida,
                IUmskz,
                IXblnr,
                null, 
                environmentVariables.Target__c
            );
            Integer cant = 0;
            for (ConsultarContaCorriente.ZefiFbl5n item : result.item) {
                Map<String, Object> zipcodeMap = (Map<String, Object>)JSON.deserializeUntyped(JSON.serialize(item));
                for(String key : zipcodeMap.keySet()){
                System.debug('Key: '+key+' - vaule: '+zipcodeMap.get(key));
                }
            }
        }catch (Exception e) {
            ErrorSap = String.valueOf(e);
        }
        
    }
}